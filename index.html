<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Видеоплеер</title>
    <script src="./library/aframe.min.js"></script>
    <script src="./library/aframe-ar.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Arial', sans-serif; margin: 0; }
        #instructions { transition: opacity 0.3s ease-in-out; }
        .hidden { opacity: 0; pointer-events: none; }
        .visible { opacity: 1; pointer-events: auto; }
        .ar-scene { width: 100vw; height: 100vh; }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <!-- Заголовок с навигацией -->
    <header class="bg-blue-800 p-4 shadow-md">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold">AR Видеоопыт</h1>
            <div class="flex space-x-4">
                <button id="toggleInstructions" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded transition duration-200">Показать инструкции</button>
                <button id="resetVideos" class="bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded transition duration-200">Сбросить видео</button>
            </div>
        </div>
    </header>

    <!-- Секция с инструкциями -->
    <div id="instructions" class="hidden container mx-auto mt-6 p-6 bg-gray-800 rounded-lg shadow-lg">
        <h2 class="text-xl font-semibold mb-4">Как использовать AR видеоплеер</h2>
        <ul class="list-disc pl-5 space-y-2">
            <li>Наведите камеру вашего устройства на один из AR-маркеров (Hiro, A, B или C).</li>
            <li>Когда маркер будет распознан, появится видео и начнёт воспроизводиться со звуком.</li>
            <li>Уберите камеру от маркера, чтобы приостановить видео и выключить звук.</li>
            <li>Используйте кнопку "Сбросить видео", чтобы остановить и перемотать все видео в начало.</li>
            <li>Убедитесь, что ваш браузер имеет доступ к камере для работы AR-опыта.</li>
            <li>Скачайте шаблоны маркеров по следующим ссылкам, если необходимо: 
                <a href="./marker/pattern-hiro.patt" class="text-blue-400 hover:underline">Hiro</a>, 
                <a href="./marker/pattern-letterA.patt" class="text-blue-400 hover:underline">A</a>, 
                <a href="./marker/pattern-letterB.patt" class="text-blue-400 hover:underline">B</a>, 
                <a href="./marker/pattern-letterC.patt" class="text-blue-400 hover:underline">C</a>.
            </li>
        </ul>
    </div>

    <!-- AR сцена -->
    <a-scene embedded arjs class="ar-scene">
        <!-- Маркер Hiro -->
        <a-marker type="pattern" url="./marker/pattern-hiro.patt" emitevents="true" id="marker_hiro">
            <a-video id="video1" src="#test-video" width="16" height="9" position="0 0 0" rotation="-90 0 0" scale="0.25 0.25 0.25" visible="true"></a-video>
        </a-marker>
        <a-entity camera></a-entity>
        <!-- Маркер A -->
        <a-marker type="pattern" url="./marker/pattern-letterA.patt" emitevents="true" id="marker_A">
            <a-video id="video2" src="#A-video" width="16" height="9" position="0 0 0" rotation="-90 0 0" scale="0.25 0.25 0.25" visible="true"></a-video>
        </a-marker>
        <a-entity camera></a-entity>
        <!-- Маркер B -->
        <a-marker type="pattern" url="./marker/pattern-letterB.patt" emitevents="true" id="marker_B">
            <a-video id="video3" src="#B-video" width="16" height="9" position="0 0 0" rotation="-90 0 0" scale="0.25 0.25 0.25" visible="true"></a-video>
        </a-marker>
        <a-entity camera></a-entity>
        <!-- Маркер C -->
        <a-marker type="pattern" url="./marker/pattern-letterC.patt" emitevents="true" id="marker_C">
            <a-video id="video4" src="#C-video" width="16" height="9" position="0 0 0" rotation="-90 0 0" scale="0.25 0.25 0.25" visible="true"></a-video>
        </a-marker>
        <a-entity camera></a-entity>

        <!-- Список видео -->
        <a-assets>
            <video id="test-video" autoplay loop crossorigin="anonymous" playsinline>
                <source src="./videos/yar.mp4" type="video/mp4">
            </video>
            <video id="A-video" autoplay loop crossorigin="anonymous" playsinline>
                <source src="./videos/yar.mp4" type="video/mp4">
            </video>
            <video id="B-video" autoplay loop crossorigin="anonymous" playsinline>
                <source src="./videos/yar.mp4" type="video/mp4">
            </video>
            <video id="C-video" autoplay loop crossorigin="anonymous" playsinline>
                <source src="./videos/yar.mp4" type="video/mp4">
            </video>
        </a-assets>
    </a-scene>

    <script>
        // Показать/скрыть инструкции
        document.getElementById('toggleInstructions').addEventListener('click', function () {
            var instructions = document.getElementById('instructions');
            instructions.classList.toggle('hidden');
            instructions.classList.toggle('visible');
            this.textContent = instructions.classList.contains('hidden') ? 'Показать инструкции' : 'Скрыть инструкции';
        });

        // Сброс всех видео
        document.getElementById('resetVideos').addEventListener('click', function () {
            ['video1', 'video2', 'video3', 'video4'].forEach(function (id) {
                var video = document.querySelector('#' + id);
                var videoElement = video.components.material.material.map.image;
                videoElement.pause();
                videoElement.currentTime = 0;
                videoElement.muted = true;
            });
        });

        // Проверка доступа к камере
        navigator.mediaDevices.getUserMedia({ video: true })
            .catch(function (err) {
                alert('Не удалось получить доступ к камере. Пожалуйста, разрешите доступ к камере в настройках браузера.');
            });

        // Обработчики событий для маркеров
        marker_hiro.addEventListener('markerFound', function () {
            var video1 = document.querySelector('#video1');
            var videoElement = video1.components.material.material.map.image;
            videoElement.play();
            videoElement.muted = false;
        });

        marker_hiro.addEventListener('markerLost', function () {
            var video1 = document.querySelector('#video1');
            var videoElement = video1.components.material.material.map.image;
            videoElement.currentTime = 0;
            videoElement.muted = true;
        });

        marker_A.addEventListener('markerFound', function () {
            var video2 = document.querySelector('#video2');
            var videoElement = video2.components.material.material.map.image;
            videoElement.play();
            videoElement.muted = false;
        });

        marker_A.addEventListener('markerLost', function () {
            var video2 = document.querySelector('#video2');
            var videoElement = video2.components.material.material.map.image;
            videoElement.currentTime = 0;
            videoElement.muted = true;
        });

        marker_B.addEventListener('markerFound', function () {
            var video3 = document.querySelector('#video3');
            var videoElement = video3.components.material.material.map.image;
            videoElement.play();
            videoElement.muted = false;
        });

        marker_B.addEventListener('markerLost', function () {
            var video3 = document.querySelector('#video3');
            var videoElement = video3.components.material.material.map.image;
            videoElement.currentTime = 0;
            videoElement.muted = true;
        });

        marker_C.addEventListener('markerFound', function () {
            var video4 = document.querySelector('#video4');
            var videoElement = video4.components.material.material.map.image;
            videoElement.play();
            videoElement.muted = false;
        });

        marker_C.addEventListener('markerLost', function () {
            var video4 = document.querySelector('#video4');
            var videoElement = video4.components.material.material.map.image;
            videoElement.currentTime = 0;
            videoElement.muted = true;
        });
    </script>
</body>
</html>
