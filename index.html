<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR.js Видеоплеер</title>
    <script src="./library/aframe.min.js"></script>
    <script src="./library/aframe-ar.js"></script>
    <style>
        #loadingOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: black;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            flex-direction: column;
            font-family: Arial, sans-serif;
        }
        #loadingText {
            margin-top: 10px;
            font-size: 18px;
        }
    </style>
</head>
<body style="margin: 0; overflow: hidden;">
    <!-- Наложение для отображения прогресса загрузки -->
    <div id="loadingOverlay">
        <div id="loadingText">Загрузка видео: 0%</div>
    </div>

    <a-scene embedded arjs>
        <!-- ------------------------Маркер hiro--------------------- -->
        <a-marker type="pattern" url="./marker/pattern-hiro.patt" emitevents="true" id="marker_hiro">
            <!-- Видеоэлемент -->
            <a-video id="video1" src="#test-video" width="16" height="9" position="0 0 0" rotation="-90 0 0" scale="0.25 0.25 0.25" visible="true"></a-video>
        </a-marker>
        <a-entity camera></a-entity>
        <!-- ------------------------Маркер hiro--------------------- -->
        <!-- ------------------------Маркер A------------------------ -->
        <a-marker type="pattern" url="./marker/pattern-letterA.patt" emitevents="true" id="marker_A">
            <!-- Видеоэлемент -->
            <a-video id="video2" src="#A-video" width="16" height="9" position="0 0 0" rotation="-90 0 0" scale="0.25 0.25 0.25" visible="true"></a-video>
        </a-marker>
        <a-entity camera></a-entity>
        <!-- ------------------------Маркер A------------------------ -->
        <!-- ------------------------Маркер B------------------------ -->
        <a-marker type="pattern" url="./marker/pattern-letterB.patt" emitevents="true" id="marker_B">
            <!-- Видеоэлемент -->
            <a-video id="video3" src="#B-video" width="16" height="9" position="0 0 0" rotation="-90 0 0" scale="0.25 0.25 0.25" visible="true"></a-video>
        </a-marker>
        <a-entity camera></a-entity>
        <!-- ------------------------Маркер B------------------------ -->
        <!-- ------------------------Маркер C------------------------ -->
        <a-marker type="pattern" url="./marker/pattern-letterC.patt" emitevents="true" id="marker_C">
            <!-- Видеоэлемент -->
            <a-video id="video4" src="#C-video" width="16" height="9" position="0 0 0" rotation="-90 0 0" scale="0.25 0.25 0.25" visible="true"></a-video>
        </a-marker>
        <a-entity camera></a-entity>
        <!-- ------------------------Маркер C------------------------ -->

        <!-- Список видео -->
        <a-assets>
            <video id="test-video" autoplay loop crossorigin="anonymous" playsinline preload="auto">
                <source src="./videos/yar.mp4" type="video/mp4">
            </video>
            <video id="A-video" autoplay loop crossorigin="anonymous" playsinline preload="auto">
                <source src="./videos/yar.mp4" type="video/mp4">
            </video>
            <video id="B-video" autoplay loop crossorigin="anonymous" playsinline preload="auto">
                <source src="./videos/yar.mp4" type="video/mp4">
            </video>
            <video id="C-video" autoplay loop crossorigin="anonymous" playsinline preload="auto">
                <source src="./videos/yar.mp4" type="video/mp4">
            </video>
        </a-assets>
        <!-- Список видео -->
    </a-scene>

    <!-- Инструкции для пользователя -->
    <div style="position: fixed; bottom: 10px; left: 10px; color: white; background: rgba(0, 0, 0, 0.7); padding: 10px; font-family: Arial, sans-serif; z-index: 100;">
        <h3>Инструкции по использованию AR.js Видеоплеера</h3>
        <p>1. Направьте камеру вашего устройства на один из маркеров (hiro, A, B или C).</p>
        <p>2. При обнаружении маркера начнется воспроизведение соответствующего видео.</p>
        <p>3. Если маркер пропадает из поля зрения камеры, видео останавливается и сбрасывается на начало.</p>
        <p>4. Дождитесь полной загрузки видео. Прогресс загрузки отображается на экране.</p>
        <p>5. Убедитесь, что у вас хорошее освещение и маркер четко виден для корректной работы AR.</p>
    </div>

    <script>
        // Показать прогресс загрузки видео
        const videos = ['test-video', 'A-video', 'B-video', 'C-video'];
        let loadedVideos = 0;
        const totalVideos = videos.length;
        const loadingText = document.getElementById('loadingText');
        const loadingOverlay = document.getElementById('loadingOverlay');

        videos.forEach(videoId => {
            const video = document.getElementById(videoId);
            video.addEventListener('progress', () => {
                if (video.buffered.length > 0 && video.buffered.end(0) > 0) {
                    const percent = (video.buffered.end(0) / video.duration) * 100;
                    const totalPercent = (loadedVideos / totalVideos) * 100;
                    loadingText.textContent = `Загрузка видео: ${Math.round(totalPercent)}%`;
                }
            });
            video.addEventListener('canplaythrough', () => {
                loadedVideos++;
                const totalPercent = (loadedVideos / totalVideos) * 100;
                loadingText.textContent = `Загрузка видео: ${Math.round(totalPercent)}%`;
                if (loadedVideos === totalVideos) {
                    loadingOverlay.style.display = 'none';
                }
            });
        });

        // Обнаружение маркера hiro
        const marker_hiro = document.querySelector('#marker_hiro');
        marker_hiro.addEventListener('markerFound', function () {
            const video1 = document.querySelector('#video1');
            const videoElement = video1.components.material.material.map.image;
            videoElement.play();
            videoElement.muted = false;
        });

        marker_hiro.addEventListener('markerLost', function () {
            const video1 = document.querySelector('#video1');
            const videoElement = video1.components.material.material.map.image;
            videoElement.currentTime = 0;
            videoElement.muted = true;
        });

        // Обнаружение маркера A
        const marker_A = document.querySelector('#marker_A');
        marker_A.addEventListener('markerFound', function () {
            const video2 = document.querySelector('#video2');
            const videoElement = video2.components.material.material.map.image;
            videoElement.play();
            videoElement.muted = false;
        });

        marker_A.addEventListener('markerLost', function () {
            const video2 = document.querySelector('#video2');
            const videoElement = video2.components.material.material.map.image;
            videoElement.currentTime = 0;
            videoElement.muted = true;
        });

        // Обнаружение маркера B
        const marker_B = document.querySelector('#marker_B');
        marker_B.addEventListener('markerFound', function () {
            const video3 = document.querySelector('#video3');
            const videoElement = video3.components.material.material.map.image;
            videoElement.play();
            videoElement.muted = false;
        });

        marker_B.addEventListener('markerLost', function () {
            const video3 = document.querySelector('#video3');
            const videoElement = video3.components.material.material.map.image;
            videoElement.currentTime = 0;
            videoElement.muted = true;
        });

        // Обнаружение маркера C
        const marker_C = document.querySelector('#marker_C');
        marker_C.addEventListener('markerFound', function () {
            const video4 = document.querySelector('#video4');
            const videoElement = video4.components.material.material.map.image;
            videoElement.play();
            videoElement.muted = false;
        });

        marker_C.addEventListener('markerLost', function () {
            const video4 = document.querySelector('#video4');
            const videoElement = video4.components.material.material.map.image;
            videoElement.currentTime = 0;
            videoElement.muted = true;
        });
    </script>
</body>
</html>
